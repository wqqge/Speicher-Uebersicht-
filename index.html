<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>DMX Operator 240 ‚Äì Planung</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  font-family:Arial,sans-serif;
  background:#0f172a;
  color:#e5e7eb;
  margin:0;
  padding:20px;
}
h1,h2{color:#38bdf8}
.container{max-width:1500px;margin:auto}

input{
  width:100%;
  background:#020617;
  color:#e5e7eb;
  border:1px solid #1e293b;
  padding:6px;
}

button{
  background:#38bdf8;
  color:#020617;
  border:none;
  padding:8px 14px;
  border-radius:8px;
  cursor:pointer;
  margin-right:6px;
}
button:hover{background:#0ea5e9}

table{
  width:100%;
  border-collapse:collapse;
  background:#020617;
  margin-bottom:28px;
}
th,td{
  border:1px solid #1e293b;
  padding:6px;
  vertical-align:top;
}
th{color:#7dd3fc}

/* ===== Bank-Trennung ===== */
.bank-header td{
  background:#020617;
  color:#38bdf8;
  font-weight:bold;
  padding:10px;
  border-top:3px solid #38bdf8;
}
.bank-spacer td{
  border:none;
  height:12px;
  background:transparent;
}

/* ===== Chase Szenen ===== */
.scene-grid{
  display:grid;
  grid-template-columns:repeat(2,1fr);
  gap:4px;
  max-height:180px;
  overflow:auto;
  font-size:12px;
}
.scene-grid label{
  display:flex;
  gap:6px;
  align-items:center;
  white-space:nowrap;
}

/* B√ºhne */
#stage{
  width:100%;
  max-width:1000px;
  height:450px;
  background:#020617;
  border:2px dashed #38bdf8;
  border-radius:12px;
  position:relative;
  margin-bottom:30px;
}
.fixture{
  width:44px;
  height:44px;
  background:#38bdf8;
  color:#020617;
  border-radius:50%;
  position:absolute;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:grab;
  font-size:11px;
  font-weight:bold;
}
</style>
</head>

<body>
<div class="container">

<h1>DMX Operator 240 ‚Äì Planung</h1>

<button onclick="downloadBackup()">‚¨áÔ∏è Backup herunterladen</button>
<button onclick="document.getElementById('importFile').click()">üìÇ Backup importieren</button>
<input type="file" id="importFile" accept=".json" hidden>

<h2>B√ºhne</h2>
<button onclick="addFixture()">‚ûï Scheinwerfer</button>
<div id="stage"></div>

<h2>Szenen ‚Äì 30 B√§nke √ó 8 Szenen</h2>
<table>
<thead>
<tr>
  <th>Bank</th>
  <th>Szene</th>
  <th>Name</th>
  <th>Notizen</th>
</tr>
</thead>
<tbody id="sceneBody"></tbody>
</table>

<h2>Chases</h2>
<table>
<thead>
<tr>
  <th>Name</th>
  <th>Szenen (mit Namen)</th>
  <th>Speed</th>
  <th>Modus</th>
  <th>Notizen</th>
</tr>
</thead>
<tbody id="chaseBody"></tbody>
</table>
<button onclick="addChase()">‚ûï Chase</button>

</div>

<script>
/* ---------- B√ºhne ---------- */
let fixtureCount=0;
function addFixture(x=50,y=50){
  fixtureCount++;
  const f=document.createElement('div');
  f.className='fixture';
  f.style.left=x+'px';
  f.style.top=y+'px';
  f.textContent=fixtureCount;
  stage.appendChild(f);
}

/* ---------- Szenen ---------- */
const sceneBody=document.getElementById('sceneBody');
const sceneNames={};

for(let bank=1;bank<=30;bank++){

  // Bank Header
  const h=document.createElement('tr');
  h.className='bank-header';
  h.innerHTML=`<td colspan="4">Bank ${bank}</td>`;
  sceneBody.appendChild(h);

  for(let s=1;s<=8;s++){
    const id=`B${bank}S${s}`;
    sceneNames[id]='';

    const tr=document.createElement('tr');
    const nameInput=document.createElement('input');
    nameInput.dataset.scene=id;
    nameInput.oninput=()=>{
      sceneNames[id]=nameInput.value;
      updateAllChaseLabels();
    };

    tr.innerHTML=`
      <td>${bank}</td>
      <td>${s}</td>
      <td></td>
      <td><input></td>
    `;
    tr.children[2].appendChild(nameInput);
    sceneBody.appendChild(tr);
  }

  // Abstand nach Bank
  const sp=document.createElement('tr');
  sp.className='bank-spacer';
  sp.innerHTML='<td colspan="4"></td>';
  sceneBody.appendChild(sp);
}

/* ---------- Chases ---------- */
const chaseBody=document.getElementById('chaseBody');

function buildSceneSelector(){
  const grid=document.createElement('div');
  grid.className='scene-grid';

  Object.keys(sceneNames).forEach(id=>{
    const label=document.createElement('label');
    label.dataset.scene=id;
    label.innerHTML=`
      <input type="checkbox" value="${id}">
      <span>${id} ‚Äì </span><span class="scene-name"></span>
    `;
    grid.appendChild(label);
  });
  return grid;
}

function updateAllChaseLabels(){
  document.querySelectorAll('[data-scene]').forEach(l=>{
    const id=l.dataset.scene;
    l.querySelector('.scene-name').textContent =
      sceneNames[id] || '(kein Name)';
  });
}

function addChase(){
  const tr=document.createElement('tr');
  tr.innerHTML=`
    <td><input class="chase-name"></td>
    <td></td>
    <td><input class="chase-speed"></td>
    <td><input class="chase-mode"></td>
    <td><input class="chase-note"></td>
  `;
  tr.children[1].appendChild(buildSceneSelector());
  chaseBody.appendChild(tr);
  updateAllChaseLabels();
}

/* ---------- Backup ---------- */
function downloadBackup(){
  const data={
    scenes:sceneNames,
    chases:[...chaseBody.children].map(tr=>({
      name:tr.querySelector('.chase-name').value,
      speed:tr.querySelector('.chase-speed').value,
      mode:tr.querySelector('.chase-mode').value,
      note:tr.querySelector('.chase-note').value,
      scenes:[...tr.querySelectorAll('input[type=checkbox]:checked')].map(c=>c.value)
    }))
  };

  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='dmx-backup.json';
  a.click();
}

/* ---------- Import ---------- */
importFile.onchange=e=>{
  const file=e.target.files[0];
  if(!file)return;

  const r=new FileReader();
  r.onload=()=>{
    const data=JSON.parse(r.result);

    Object.keys(sceneNames).forEach(id=>{
      sceneNames[id]=data.scenes?.[id]||'';
      const i=document.querySelector(`input[data-scene="${id}"]`);
      if(i)i.value=sceneNames[id];
    });

    chaseBody.innerHTML='';
    data.chases?.forEach(c=>{
      addChase();
      const tr=chaseBody.lastChild;
      tr.querySelector('.chase-name').value=c.name;
      tr.querySelector('.chase-speed').value=c.speed;
      tr.querySelector('.chase-mode').value=c.mode;
      tr.querySelector('.chase-note').value=c.note;
      c.scenes.forEach(id=>{
        const cb=tr.querySelector(`input[value="${id}"]`);
        if(cb)cb.checked=true;
      });
    });

    updateAllChaseLabels();
    alert('Backup importiert');
  };
  r.readAsText(file);
};

/* Init */
addChase();
updateAllChaseLabels();
</script>
</body>
</html>
