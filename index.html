<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DMX Operator 240 ‚Äì Licht- & B√ºhnenplan</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}

h1, h2 { color: #38bdf8; }

.container { max-width: 1400px; margin: auto; }

input, select {
  width: 100%;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #1e293b;
  padding: 6px;
}

button {
  background: #38bdf8;
  color: #020617;
  border: none;
  padding: 8px 14px;
  font-size: 14px;
  border-radius: 8px;
  cursor: pointer;
  margin-right: 6px;
  margin-bottom: 6px;
}

button:hover { background: #0ea5e9; }

.toolbar {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

/* ===== B√ºhne ===== */
#stage {
  width: 100%;
  max-width: 1000px;
  height: 450px;
  background: #020617;
  border: 2px dashed #38bdf8;
  border-radius: 12px;
  position: relative;
  margin-bottom: 30px;
}

.fixture {
  width: 44px;
  height: 44px;
  background: #38bdf8;
  color: #020617;
  border-radius: 50%;
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  font-size: 11px;
  font-weight: bold;
  user-select: none;
}

.fixture:active { cursor: grabbing; }

.fixture div {
  text-align: center;
  line-height: 1.1;
}

/* ===== Tabellen ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  background: #020617;
}

th, td {
  border: 1px solid #1e293b;
  padding: 6px;
}

th {
  background: #020617;
  color: #7dd3fc;
  position: sticky;
  top: 0;
}

.footer {
  opacity: 0.6;
  font-size: 13px;
  margin-top: 20px;
}

/* ===== Druckansicht ===== */
@media print {
  body {
    background: white;
    color: black;
  }

  .toolbar,
  table,
  h1,
  h2:not(:first-of-type),
  button,
  input,
  select,
  .footer {
    display: none !important;
  }

  #stage {
    display: block;
    border: 2px solid black;
    height: 500px;
  }

  .fixture {
    background: white;
    border: 2px solid black;
    color: black;
  }
}
</style>
</head>

<body>
<div class="container">

<h1>DMX Operator 240 ‚Äì Licht- & B√ºhnenplan</h1>

<div class="toolbar">
  <select id="projectSelect" onchange="loadProject()"></select>
  <input id="newProjectName" placeholder="Neues Projekt‚Ä¶" />
  <button onclick="createProject()">üìÅ Projekt</button>
  <button onclick="saveData()">üíæ Speichern</button>
  <button onclick="window.print()">üñ®Ô∏è Drucken</button>
</div>

<h2>B√ºhne ‚Äì Scheinwerfer positionieren</h2>

<div class="toolbar">
  <button onclick="addFixture()">‚ûï Scheinwerfer</button>
  <button onclick="saveFixtures()">üíæ Positionen speichern</button>
</div>

<div id="stage"></div>

<h2>Szenen / Cues</h2>
<table id="sceneTable">
<thead>
<tr>
  <th>Bank</th>
  <th>Szene</th>
  <th>Name</th>
  <th>Ger√§te</th>
  <th>Werte</th>
  <th>Notizen</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="addSceneRow()">‚ûï Szene</button>

<p class="footer">Offline ¬∑ lokale Speicherung ¬∑ Druckfertiger Lichtplan</p>

</div>

<script>
let currentProject = 'default';
let fixtureCount = 0;

/* ===== B√ºhne ===== */
function addFixture(x = 50, y = 50, dmx = '') {
  fixtureCount++;

  const f = document.createElement('div');
  f.className = 'fixture';
  f.style.left = x + 'px';
  f.style.top = y + 'px';
  f.dataset.dmx = dmx;

  f.innerHTML = `
    <div>
      ${fixtureCount}<br>
      <span class="dmx">${dmx || 'DMX?'}</span>
    </div>
  `;

  f.ondblclick = () => {
    const newDMX = prompt('DMX-Adresse:', f.dataset.dmx || '');
    if (newDMX !== null) {
      f.dataset.dmx = newDMX;
      f.querySelector('.dmx').textContent = newDMX || 'DMX?';
    }
  };

  makeDraggable(f);
  document.getElementById('stage').appendChild(f);
}

function makeDraggable(el) {
  let offsetX, offsetY, dragging = false;

  el.addEventListener('mousedown', e => {
    dragging = true;
    offsetX = e.offsetX;
    offsetY = e.offsetY;
  });

  document.addEventListener('mousemove', e => {
    if (!dragging) return;
    const stage = document.getElementById('stage');
    const r = stage.getBoundingClientRect();

    let x = e.clientX - r.left - offsetX;
    let y = e.clientY - r.top - offsetY;

    x = Math.max(0, Math.min(stage.clientWidth - 44, x));
    y = Math.max(0, Math.min(stage.clientHeight - 44, y));

    el.style.left = x + 'px';
    el.style.top = y + 'px';
  });

  document.addEventListener('mouseup', () => dragging = false);
}

function saveFixtures() {
  const fixtures = [...document.querySelectorAll('.fixture')].map(f => ({
    x: f.style.left,
    y: f.style.top,
    dmx: f.dataset.dmx || ''
  }));
  localStorage.setItem('fixtures_' + currentProject, JSON.stringify(fixtures));
  alert('Scheinwerfer gespeichert');
}

function loadFixtures() {
  const data = JSON.parse(localStorage.getItem('fixtures_' + currentProject));
  if (!data) return;
  const stage = document.getElementById('stage');
  stage.innerHTML = '';
  fixtureCount = 0;
  data.forEach(f => addFixture(parseInt(f.x), parseInt(f.y), f.dmx));
}

/* ===== Szenen ===== */
function addSceneRow() {
  const tr = document.createElement('tr');
  for (let i = 0; i < 6; i++) {
    const td = document.createElement('td');
    const input = document.createElement('input');
    td.appendChild(input);
    tr.appendChild(td);
  }
  document.querySelector('#sceneTable tbody').appendChild(tr);
}

/* ===== Projekte ===== */
function saveData() {
  const scenes = [...document.querySelectorAll('#sceneTable input')].map(i => i.value);
  localStorage.setItem('dmx_' + currentProject, JSON.stringify({ scenes }));
  saveFixtures();
}

function loadData() {
  const data = JSON.parse(localStorage.getItem('dmx_' + currentProject));
  if (!data) return;
  document.querySelectorAll('#sceneTable input').forEach((i, n) => i.value = data.scenes[n] || '');
}

function loadProjectList() {
  const sel = document.getElementById('projectSelect');
  sel.innerHTML = '';
  Object.keys(localStorage)
    .filter(k => k.startsWith('dmx_'))
    .forEach(k => {
      const name = k.replace('dmx_', '');
      const o = document.createElement('option');
      o.value = name;
      o.textContent = name;
      sel.appendChild(o);
    });
}

function loadProject() {
  currentProject = document.getElementById('projectSelect').value;
  document.querySelector('#sceneTable tbody').innerHTML = '';
  for (let i = 0; i < 10; i++) addSceneRow();
  loadData();
  loadFixtures();
}

function createProject() {
  const name = document.getElementById('newProjectName').value.trim();
  if (!name) return;
  currentProject = name;
  localStorage.setItem('dmx_' + name, '{}');
  loadProjectList();
  document.getElementById('projectSelect').value = name;
  loadProject();
}

/* Init */
for (let i = 0; i < 10; i++) addSceneRow();
loadProjectList();
loadProject();
</script>

</body>
</html>
