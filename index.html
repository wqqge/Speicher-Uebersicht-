<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DMX Operator 240 ‚Äì Lichtplan & Cues</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #0f172a;
  color: #e5e7eb;
  margin: 0;
  padding: 20px;
}

h1, h2 { color: #38bdf8; }
.container { max-width: 1400px; margin: auto; }

input, select {
  width: 100%;
  background: #020617;
  color: #e5e7eb;
  border: 1px solid #1e293b;
  padding: 6px;
}

button {
  background: #38bdf8;
  color: #020617;
  border: none;
  padding: 8px 14px;
  border-radius: 8px;
  cursor: pointer;
}

button:hover { background: #0ea5e9; }

.toolbar {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 10px;
}

/* ===== B√ºhne ===== */
#stage {
  width: 100%;
  max-width: 1000px;
  height: 450px;
  background: #020617;
  border: 2px dashed #38bdf8;
  border-radius: 12px;
  position: relative;
  margin-bottom: 30px;
}

.fixture {
  width: 44px;
  height: 44px;
  background: #38bdf8;
  color: #020617;
  border-radius: 50%;
  position: absolute;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: grab;
  font-size: 11px;
  font-weight: bold;
  user-select: none;
}

.fixture div {
  text-align: center;
  line-height: 1.1;
}

.fixture:active { cursor: grabbing; }

/* ===== Tabellen ===== */
table {
  width: 100%;
  border-collapse: collapse;
  margin-bottom: 20px;
  background: #020617;
}

th, td {
  border: 1px solid #1e293b;
  padding: 6px;
}

th {
  color: #7dd3fc;
  position: sticky;
  top: 0;
}

/* ===== Druck ===== */
@media print {
  body { background: white; color: black; }

  .toolbar, table, h1, h2:not(:first-of-type), button, input, select {
    display: none !important;
  }

  #stage {
    display: block;
    border: 2px solid black;
    height: 500px;
  }

  .fixture {
    background: white;
    border: 2px solid black;
    color: black;
  }
}
</style>
</head>

<body>
<div class="container">

<h1>DMX Operator 240 ‚Äì Planung</h1>

<div class="toolbar">
  <select id="projectSelect" onchange="loadProject()"></select>
  <input id="newProjectName" placeholder="Neues Projekt">
  <button onclick="createProject()">üìÅ Projekt</button>
  <button onclick="saveAll()">üíæ Speichern</button>
  <button onclick="print()">üñ®Ô∏è Drucken</button>
</div>

<h2>B√ºhne ‚Äì Scheinwerfer</h2>

<div class="toolbar">
  <button onclick="addFixture()">‚ûï Scheinwerfer</button>
</div>

<div id="stage"></div>

<h2>Szenen / Bank√ºbersicht</h2>
<table id="sceneTable">
<thead>
<tr>
  <th>Bank</th>
  <th>Szene</th>
  <th>Name</th>
  <th>Ger√§te</th>
  <th>Werte</th>
  <th>Notizen</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="addSceneRow()">‚ûï Szene</button>

<h2>Chases / Lauflichter</h2>
<table id="chaseTable">
<thead>
<tr>
  <th>Chase</th>
  <th>Schritte</th>
  <th>Szenen</th>
  <th>Speed</th>
  <th>Modus</th>
  <th>Notizen</th>
</tr>
</thead>
<tbody></tbody>
</table>
<button onclick="addChaseRow()">‚ûï Chase</button>

</div>

<script>
let currentProject = 'default';
let fixtureCount = 0;

/* ===== B√ºhne ===== */
function addFixture(x=50,y=50,dmx='') {
  fixtureCount++;
  const f = document.createElement('div');
  f.className = 'fixture';
  f.style.left = x+'px';
  f.style.top = y+'px';
  f.dataset.dmx = dmx;

  f.innerHTML = `<div>${fixtureCount}<br><span>${dmx||'DMX?'}</span></div>`;

  f.ondblclick = () => {
    const d = prompt('DMX-Adresse:', f.dataset.dmx);
    if (d !== null) {
      f.dataset.dmx = d;
      f.querySelector('span').textContent = d || 'DMX?';
    }
  };

  f.oncontextmenu = e => {
    e.preventDefault();
    if (confirm('Scheinwerfer l√∂schen?')) f.remove();
  };

  makeDraggable(f);
  document.getElementById('stage').appendChild(f);
}

function makeDraggable(el){
  let ox, oy, drag=false;
  el.onmousedown = e => { drag=true; ox=e.offsetX; oy=e.offsetY; };
  document.onmousemove = e => {
    if(!drag) return;
    const s=document.getElementById('stage').getBoundingClientRect();
    el.style.left = Math.max(0,Math.min(s.width-44,e.clientX-s.left-ox))+'px';
    el.style.top  = Math.max(0,Math.min(s.height-44,e.clientY-s.top-oy))+'px';
  };
  document.onmouseup = ()=>drag=false;
}

/* ===== Tabellen ===== */
function addSceneRow() {
  const tr=document.createElement('tr');
  for(let i=0;i<6;i++){
    const td=document.createElement('td');
    td.appendChild(document.createElement('input'));
    tr.appendChild(td);
  }
  sceneTable.tBodies[0].appendChild(tr);
}

function addChaseRow() {
  const tr=document.createElement('tr');
  for(let i=0;i<6;i++){
    const td=document.createElement('td');
    td.appendChild(document.createElement('input'));
    tr.appendChild(td);
  }
  chaseTable.tBodies[0].appendChild(tr);
}

/* ===== Speicherung ===== */
function saveAll(){
  const data={
    scenes:[...sceneTable.querySelectorAll('input')].map(i=>i.value),
    chases:[...chaseTable.querySelectorAll('input')].map(i=>i.value),
    fixtures:[...document.querySelectorAll('.fixture')].map(f=>({
      x:f.style.left,y:f.style.top,dmx:f.dataset.dmx
    }))
  };
  localStorage.setItem('dmx_'+currentProject,JSON.stringify(data));
  alert('Gespeichert');
}

function loadProject(){
  currentProject=projectSelect.value;
  const d=JSON.parse(localStorage.getItem('dmx_'+currentProject)||'{}');

  sceneTable.tBodies[0].innerHTML='';
  chaseTable.tBodies[0].innerHTML='';
  for(let i=0;i<10;i++) addSceneRow();
  for(let i=0;i<6;i++) addChaseRow();

  [...sceneTable.querySelectorAll('input')].forEach((i,n)=>i.value=d.scenes?.[n]||'');
  [...chaseTable.querySelectorAll('input')].forEach((i,n)=>i.value=d.chases?.[n]||'');

  stage.innerHTML=''; fixtureCount=0;
  d.fixtures?.forEach(f=>addFixture(parseInt(f.x),parseInt(f.y),f.dmx));
}

function createProject(){
  const n=newProjectName.value.trim();
  if(!n) return;
  localStorage.setItem('dmx_'+n,'{}');
  loadProjects(); projectSelect.value=n; loadProject();
}

function loadProjects(){
  projectSelect.innerHTML='';
  Object.keys(localStorage).filter(k=>k.startsWith('dmx_')).forEach(k=>{
    const o=document.createElement('option');
    o.value=k.replace('dmx_','');
    o.textContent=o.value;
    projectSelect.appendChild(o);
  });
}

/* Init */
for(let i=0;i<10;i++) addSceneRow();
for(let i=0;i<6;i++) addChaseRow();
loadProjects(); loadProject();
</script>

</body>
</html>
